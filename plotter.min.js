var $jscomp={scope:{},checkStringArgs:function(b,m,q){if(null==b)throw new TypeError("The 'this' value for String.prototype."+q+" must not be null or undefined");if(m instanceof RegExp)throw new TypeError("First argument to String.prototype."+q+" must not be a regular expression");return b+""}};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,m,q){if(q.get||q.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[m]=q.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,m,q,u){if(m){q=$jscomp.global;b=b.split(".");for(u=0;u<b.length-1;u++){var Ba=b[u];Ba in q||(q[Ba]={});q=q[Ba]}b=b[b.length-1];u=q[b];m=m(u);m!=u&&null!=m&&$jscomp.defineProperty(q,b,{configurable:!0,writable:!0,value:m})}};
$jscomp.polyfill("String.prototype.startsWith",function(b){return b?b:function(b,q){var u=$jscomp.checkStringArgs(this,b,"startsWith");b+="";for(var m=u.length,H=b.length,U=Math.max(0,Math.min(q|0,u.length)),ga=0;ga<H&&U<m;)if(u[U++]!=b[ga++])return!1;return ga>=H}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.endsWith",function(b){return b?b:function(b,q){var u=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===q&&(q=u.length);for(var m=Math.max(0,Math.min(q|0,u.length)),H=b.length;0<H&&0<m;)if(u[--m]!=b[--H])return!1;return 0>=H}},"es6-impl","es3");
(function(b){function m(){function q(){a.useProgram(f);a.uniformMatrix4fv(f.uModel,!1,new Float32Array(Ca.flatten()));a.uniformMatrix4fv(f.uNormalMat,!1,new Float32Array(ka.flatten()));a.uniform4fv(f.uColor,[.13,.13,.13,1]);a.uniform4fv(f.uColor2,[0,0,0,1]);a.uniform4fv(f.uColor3,[.1,.1,.1,1]);a.uniform1f(f.uDice,0);a.uniform1f(f.uTextureOffset,0);var e=new x;e.rotateMatrix(Math.PI/7,(new A(-1,0,1)).normalized());e=e.multipleV(Da.negative().multiple(.1));a.uniform3fv(f.uLightPos,e.f);Ea&&WallLib.drawWalls(a,
f);a.lineWidth(1);a.useProgram(f);if(!0===la)if(a.useProgram(g),a.uniform1f(g.uTreshold,1E-4*ma),0===V){if(a.bindBuffer(a.ARRAY_BUFFER,W),a.enableVertexAttribArray(g.size),a.vertexAttribPointer(g.size,1,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,X),a.enableVertexAttribArray(g.pos),a.vertexAttribPointer(g.pos,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,Y),a.enableVertexAttribArray(g.color),a.vertexAttribPointer(g.color,3,a.FLOAT,!1,0,0),na&&a.drawArrays(a.POINTS,0,Fa),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,
oa),pa||(a.useProgram(c),a.uniform1f(c.uTreshold,1E-4*ma),a.uniform3fv(c.uCameraPos,Z.f),a.uniform3fv(c.uLightPos,[.2,10,20]),a.bindBuffer(a.ARRAY_BUFFER,W),a.enableVertexAttribArray(c.size),a.vertexAttribPointer(c.size,1,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,X),a.enableVertexAttribArray(c.pos),a.vertexAttribPointer(c.pos,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,Y),a.enableVertexAttribArray(c.color),a.vertexAttribPointer(c.color,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,Ga),a.enableVertexAttribArray(c.normal),
a.vertexAttribPointer(c.normal,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,oa)),qa)for(e=0;e<M;e++)a.drawElements(a.TRIANGLE_STRIP,Ha,a.UNSIGNED_SHORT,Ha*e*2)}else if(1===V&&0!==B&&(a.bindBuffer(a.ARRAY_BUFFER,ra[B]),a.enableVertexAttribArray(g.size),a.vertexAttribPointer(g.size,1,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,sa[B]),a.enableVertexAttribArray(g.pos),a.vertexAttribPointer(g.pos,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,ta[B]),a.enableVertexAttribArray(g.color),a.vertexAttribPointer(g.color,
3,a.FLOAT,!1,0,0),na&&a.drawArrays(a.POINTS,0,Ra[B]),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,ua[B]),pa||(a.useProgram(c),a.uniform1f(c.uTreshold,1E-4*ma),a.uniform3fv(c.uCameraPos,Z.f),a.uniform3fv(c.uLightPos,[.2,10,20]),a.bindBuffer(a.ARRAY_BUFFER,ra[B]),a.enableVertexAttribArray(c.size),a.vertexAttribPointer(c.size,1,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,sa[B]),a.enableVertexAttribArray(c.pos),a.vertexAttribPointer(c.pos,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,ta[B]),a.enableVertexAttribArray(c.color),
a.vertexAttribPointer(c.color,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,Ia[B]),a.enableVertexAttribArray(c.normal),a.vertexAttribPointer(c.normal,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,ua[B])),qa))for(e=0;e<P[B];e++)a.drawElements(a.TRIANGLE_STRIP,Ja[B],a.UNSIGNED_SHORT,Ja[B]*e*2);a.getError()!==a.NO_ERROR&&console.log("gl error "+a.getError())}function u(){a.useProgram(f);a.clearColor(I[0],I[1],I[2],I[3]);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.clear(a.COLOR_BUFFER_BIT|
a.DEPTH_BUFFER_BIT);a.useProgram(f);a.uniformMatrix4fv(f.uPerspectiveMatrix,!1,new Float32Array(aa.flatten()));a.uniformMatrix4fv(f.uCamera,!1,new Float32Array(ba.flatten()));a.uniformMatrix4fv(f.uModel,!1,new Float32Array(Ca.flatten()));a.uniformMatrix4fv(f.uView,!1,new Float32Array(Sa.flatten()));a.uniformMatrix4fv(f.uNormalMat,!1,new Float32Array(ka.flatten()));a.uniform4fv(f.uColor,[.13,.13,.13,1]);a.uniform4fv(f.uColor2,[0,0,0,1]);a.uniform4fv(f.uColor3,[.1,.1,.1,1]);a.uniform1f(f.uDice,0);a.uniform1f(f.uTextureOffset,
0);var e=new x;e.rotateMatrix(Math.PI/7,(new A(-1,0,1)).normalized());e=e.multipleV(Da.negative().multiple(.1));a.uniform3fv(f.uLightPos,e.f);a.useProgram(g);a.uniformMatrix4fv(g.uPMatrix,!1,new Float32Array(aa.flatten()));a.uniformMatrix4fv(g.uVMatrix,!1,new Float32Array(ba.flatten()));Q.translate(r.f[0],r.f[1],r.f[2]);ca.scale(J,J,J);K=ca.multiple(C.multiple(Q));a.uniformMatrix4fv(g.uMMatrix,!1,new Float32Array(K.flatten()));a.useProgram(c);a.uniformMatrix4fv(c.uPMatrix,!1,new Float32Array(aa.flatten()));
a.uniformMatrix4fv(c.uVMatrix,!1,new Float32Array(ba.flatten()));Q.translate(r.f[0],r.f[1],r.f[2]);ca.scale(J,J,J);K=ca.multiple(C.multiple(Q));a.uniformMatrix4fv(c.uMMatrix,!1,new Float32Array(K.flatten()));e=ba.multiple(K).invert().transpose();a.uniformMatrix4fv(c.uNMatrix,!1,new Float32Array(e.flatten()));a.useProgram(f);q();Ka&&(k.takeScreenshot(),Ka=!1)}function m(){u();va&&(VrLib.normalSceneFrame=b.requestAnimationFrame(m))}function H(){VrLib.drawScene(H);a.clearColor(I[0],I[1],I[2],I[3]);a.enable(a.DEPTH_TEST);
a.depthFunc(a.LEQUAL);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);var e=new x,l=f.uPerspectiveMatrix,y=f.uView,d=t.uPMatrix,D=t.uVMatrix,Ta=t.uMMatrix;a.viewport(0,0,.5*h.width,h.height);aa.makePerspective(90,16/9,.001,-1E4);a.useProgram(f);a.uniformMatrix4fv(l,!1,VrLib.frameData.leftProjectionMatrix);a.uniformMatrix4fv(y,!1,VrLib.frameData.leftViewMatrix);var b=new x;a.uniformMatrix4fv(f.uCamera,!1,new Float32Array(b.flatten()));a.useProgram(t);a.uniformMatrix4fv(d,!1,VrLib.frameData.leftProjectionMatrix);
a.uniformMatrix4fv(D,!1,VrLib.frameData.leftViewMatrix);a.uniformMatrix4fv(Ta,!1,e.flatten());La.draw(t,VrLib.getControllers(),VrLib.getControllerIds());a.useProgram(g);a.uniformMatrix4fv(g.uPMatrix,!1,VrLib.frameData.leftProjectionMatrix);a.uniformMatrix4fv(g.uVMatrix,!1,VrLib.frameData.leftViewMatrix);K=ca.multiple(C.multiple(Q));a.uniformMatrix4fv(g.uMMatrix,!1,new Float32Array(K.flatten()));a.useProgram(c);a.uniformMatrix4fv(c.uPMatrix,!1,VrLib.frameData.leftProjectionMatrix);a.uniformMatrix4fv(c.uVMatrix,
!1,VrLib.frameData.leftViewMatrix);K=ca.multiple(C.multiple(Q));a.uniformMatrix4fv(c.uMMatrix,!1,new Float32Array(K.flatten()));q();a.viewport(.5*h.width,0,.5*h.width,h.height);a.useProgram(f);a.uniformMatrix4fv(l,!1,VrLib.frameData.rightProjectionMatrix);a.uniformMatrix4fv(y,!1,VrLib.frameData.rightViewMatrix);a.uniformMatrix4fv(f.uCamera,!1,new Float32Array(b.flatten()));a.useProgram(t);a.uniformMatrix4fv(d,!1,VrLib.frameData.rightProjectionMatrix);a.uniformMatrix4fv(D,!1,VrLib.frameData.rightViewMatrix);
a.uniformMatrix4fv(Ta,!1,e.flatten());La.draw(t,VrLib.getControllers(),VrLib.getControllerIds());a.useProgram(g);a.uniformMatrix4fv(g.uPMatrix,!1,VrLib.frameData.rightProjectionMatrix);a.uniformMatrix4fv(g.uVMatrix,!1,VrLib.frameData.rightViewMatrix);a.useProgram(c);a.uniformMatrix4fv(c.uPMatrix,!1,VrLib.frameData.rightProjectionMatrix);a.uniformMatrix4fv(c.uVMatrix,!1,VrLib.frameData.rightViewMatrix);q();VrLib.submitFrame()}function U(){aa=new x;ba=new x;Ca=new x;Sa=new x;ka=new x;var a=35*Math.PI/
180,l=da/Math.tan(22.5*Math.PI/180);Z=new A(0,Math.sin(a)*l,Math.cos(a)*l);wa=new A(0,-1.7*Math.sin(a),-1.7*Math.cos(a));Ma=new A(0,0,1);Na=new A(0,1,0);var y=new x;y.rotateMatrix(a,new A(-1,0,0));var d=new x;d.rotateMatrix(-a,new A(-1,0,0));Ma=d.multipleV(Ma);Na=d.multipleV(Na);a=new x;a.translate(-Z.f[0],-Z.f[1],-Z.f[2]);d=new x;d.translate(wa.f[0],wa.f[1],wa.f[2]);ba=d.multiple(a.multiple(y));ka=d.multiple(a.multiple(y));aa.makePerspective(45,h.width/h.height,l,100)}function ga(e){a=e.getContext("webgl")||
e.getContext("experimental-webgl");WallLib.initTextures(a);a.viewport(0,0,e.width,e.height);return a}function Ua(a,l,y,d,D){var e=3*l[2*D],f=3*l[2*D+1],c=3*l[2*D+2];d=3*l[2*D-1];var b=3*l[2*D-2];l=new A(a[e],a[e+1],a[e+2]);f=new A(a[f],a[f+1],a[f+2]);c=new A(a[c],a[c+1],a[c+2]);d=new A(a[d],a[d+1],a[d+2]);a=new A(a[b],a[b+1],a[b+2]);b=f.subtract(l);c=c.subtract(l);b=b.cross(c);a=a.subtract(l);l=d.subtract(l);l=a.cross(l);l=b.add(l).divide(2).normalized();return D%y>=y/2?l.negative():l}function Va(a){var e=
[0,0,0,0,0,1,0,1,1,0,1,0,1,1,0,1,0,0,.5,0,0],y,d=0;0>=a?y=a=0:1<=a?(a=e.length/3-2,y=e.length/3-1):(d=a*(e.length/3-1),a=Math.floor(d),y=a+1,d-=a);return{red:e[3*a]*(1-d)+e[3*y]*d,green:e[3*a+1]*(1-d)+e[3*y+1]*d,blue:e[3*a+2]*(1-d)+e[3*y+2]*d}}function Ya(a){a.data&&0<a.data.size&&R.push(a.data)}function Za(a){console.log("Recorder stopped: ",a);recordedVideos.push(R);addVideoElement(R)}function $a(){if("record"===ha.textContent)a:{ia=h.captureStream();var a={mimeType:"video/webm"};R=[];try{L=new MediaRecorder(ia,
a)}catch(l){console.log("Unable to create MediaRecorder with options Object: ",l);try{a={mimeType:"video/webm,codecs=vp9"},L=new MediaRecorder(ia,a)}catch(y){console.log("Unable to create MediaRecorder with options Object: ",y);try{a="video/vp8",L=new MediaRecorder(ia,a)}catch(d){alert("MediaRecorder is not supported by this browser.\n\nTry Firefox 29 or later, or Chrome 47 or later, with Enable experimental Web Platform features enabled from chrome://flags.");console.error("Exception while creating MediaRecorder:",
d);break a}}}console.log("Created MediaRecorder",L,"with options",a);ha.textContent="Stop Recording";xa.disabled=!0;ya.disabled=!0;L.onstop=Za;L.ondataavailable=Ya;L.start(100);console.log("MediaRecorder started",L)}else L.stop(),console.log("Recorded Blobs: ",R),ha.textContent="record",xa.disabled=!1,ya.disabled=!1}function ab(){new Blob(R,{type:"video/webm"})}function bb(){var a=new Blob(R,{type:"video/webm"}),f=b.URL.createObjectURL(a),y=document.createElement("a");y.style.display="none";y.href=
f;a=document.getElementById("filename");y.download=a.value;document.body.appendChild(y);y.click();setTimeout(function(){document.body.removeChild(y);b.URL.revokeObjectURL(f)},100)}var k={},ja=.5,da=1,Da=null,za,B=0,Aa=0;WallLib.setWalls(ja,da,-1.7);var a,t,f,Oa=!1,Z,wa,Ma,Na,h,aa,ba,Ca,Sa,ka,va=!0,La,Fa=0,Ra={},V=0,g,c,W,Y,X,oa,Ga,M=0,Ha=0,ra={},ta={},sa={},ua={},Ia={},P={},Ja={},la=!1,ma=.5,Ka=!1,Ea=!0,pa=!1,na=!1,qa=!0,I=[0,0,0,1],ea=[],A=VemaLib.Vec3,x=VemaLib.Matrix4,cb=SphereLib.SphereRenderer,
p={Normal:0,Scale:1,HorizontalRotate:2,HorizontalTranslate:3,VerticalTranslate:4},r=new A(0,-1,-1),Q=new x,C=new x,ca=new x;new x;new x;var v=p.Normal,K=new x,Pa=!1,S=0,T=0,fa=new x,G=0,N=0,O=0,Qa=1,J=1,Wa=new MediaSource;Wa.addEventListener("sourceopen",function(a){console.log("MediaSource opened");Xa=Wa.addSourceBuffer('video/webm; codecs="vp8"');console.log("Source buffer: ",Xa)},!1);var L,R,Xa,ia,ha,ya,xa;k.toggleWalls=function(){Ea=!Ea};k.toggleFlatShading=function(){pa=!pa};k.togglePoints=function(){na=
!na};k.toggleMesh=function(){qa=!qa};k.getRotateCamera=function(){return Oa};k.setRotateCamera=function(a){var e=Oa;Oa=a;e||setTimeout(u,frametime)};k.step=function(){u()};k.play=function(){va?va=!1:(va=!0,m())};k.clear=function(){VrLib.setDices(dices)};k.resize=function(){h.width=b.innerWidth;h.height=b.innerHeight;aspectRatio=h.width/h.height;ja=.5/h.height*h.width*2;da=1;a.viewport(0,0,h.width,h.height);WallLib.setWalls(ja,da,-1.7);WallLib.makeWallBuffers(a);U()};k.fullScreen=function(){var a=
document.getElementById("bod");document.webkitIsFullScreen?document.webkitCancelFullScreen():a.webkitRequestFullScreen&&(a.webkitRequestFullScreen(),b.screen.orientation.lock.call(b.screen.orientation,"landscape"))};k.addHistogramSet=function(e){var f=new FileReader;f.onload=function(){var e=f.result;console.log("arraybuffer "+e);e=new Uint32Array(e);console.log("reading done");for(var d=0,D=1,c=2,b=3,l=0;256>l;l++)for(var h=0;256>h;h++)for(var g=0;256>g;g++){var n=e[l+256*h+65536*g];n>d&&(d=n,D=
l,c=h,b=g)}console.log("largest value is "+d+" r "+D+" g "+c+" b "+b);D=new Float32Array(16777216);c=new Float32Array(50331648);b=new Float32Array(50331648);for(l=0;256>l;l++)for(h=0;256>h;h++)for(g=0;256>g;g++)n=l+256*h+65536*g,D[n]=e[n]/(1*d),c[3*n]=l/256,c[3*n+1]=h/256,c[3*n+2]=g/256,b[3*n]=.005*l-.64,b[3*n+1]=.005*h-.64,b[3*n+2]=.005*g-.64;console.log("paskottu ");W=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,W);a.bufferData(a.ARRAY_BUFFER,D,a.STATIC_DRAW);Y=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,
Y);a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW);X=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,X);a.bufferData(a.ARRAY_BUFFER,b,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);Fa=16777216;la=!0;console.log("READY OR NOT")};f.onerror=function(){console.log("Danger will robinson")};f.readAsArrayBuffer(e)};k.addRadioDataSet=function(e){var f=new FileReader;f.onload=function(){var e=f.result.split("\n");V=0;console.log("Lines "+e.length);for(var d=0,c=0;c<e.length;c++)e[c].startsWith("Azimuth")&&("Frequency"===
e[c].split("\t")[1]&&(V=1),d=c+1);if(0===V){console.log("data start "+d+" line before \n"+e[d-1]+"\nfirst line \n"+e[d]);for(var c=e.length-d,b=[],h=0,l=0;l<c;l++){var g=e[l+d].split("\t"),k=parseFloat(g[0]),n=parseFloat(g[1]),g=parseFloat(g[2]);b.push({azimuth:k,elevation:n,value:g});h<Math.abs(g)&&(h=Math.abs(g))}l=0;k=b[0].azimuth;M=e=0;d=[];d.push(0);for(n=0;n<c;n++)g=b[n],k!==g.azimuth&&(console.log("points before change "+l),e<l&&(e=l),M++,d.push(l+d[d.length-1]),l=0),l++,k=g.azimuth;d.push(l+
d[d.length-1]);console.log("carray "+d);console.log("stripes "+M);Ha=2*e;for(var g=n=k=0,r=new Float32Array(b.length),z=new Float32Array(3*b.length),q=new Float32Array(3*b.length),t=new Float32Array(3*b.length),m=new Uint16Array(e*M*2),w=0;w<c;w++){var p=b[w],v=p.azimuth,u=p.elevation,p=1-Math.abs(p.value)/h;r[w]=p;var E=Va(p);z[3*w]=E.red;z[3*w+1]=E.green;z[3*w+2]=E.blue;p=new A(0,0,1*p);E=new x;E.rotationYMatrix(u);u=new x;u.rotationZMatrix(v);v=E.multiple(u).multipleV(p);v.f[0]>k&&(k=v.f[0]);v.f[1]>
n&&(n=v.f[1]);v.f[2]>g&&(g=v.f[2]);q[3*w]=v.f[0];q[3*w+1]=v.f[1];q[3*w+2]=v.f[2]}for(b=0;b<e;b++)for(w=0;w<M;w++)m[2*(b+w*e)]=d[w]+b,0<w&&(m[2*(b+w*e)+1]=m[2*(b+(w-1)*e)]);for(b=0;b<e;b++)m[2*(e-b-1)+1]=m[2*(b+(M-1)*e)];for(b=0;b<c;b++)d=Ua(q,m,e,M,b),t[3*b]=d.f[0],t[3*b+1]=d.f[1],t[3*b+2]=d.f[2];console.log("points after cahnge "+l);console.log("max x "+k+" y "+n+" z "+g+" v "+h);console.log("indexBuffer "+m);console.log("Calculated");W=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,W);a.bufferData(a.ARRAY_BUFFER,
r,a.STATIC_DRAW);Y=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,Y);a.bufferData(a.ARRAY_BUFFER,z,a.STATIC_DRAW);X=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,X);a.bufferData(a.ARRAY_BUFFER,q,a.STATIC_DRAW);Ga=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,Ga);a.bufferData(a.ARRAY_BUFFER,t,a.STATIC_DRAW);oa=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,oa);a.bufferData(a.ELEMENT_ARRAY_BUFFER,m,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);Fa=c;la=!0;console.log("READY OR NOT")}else if(1===
V){c=e[d].split("\t")[1];for(h=0;c===e[d+h].split("\t")[1];)h++;console.log("Datacount "+h);console.log("data start "+d+" line before \n"+e[d-1]+"\nfirst line \n"+e[d]);c=e.length-d;h={};b={};l={};for(k=0;k<c;k++)z=e[k+d].split("\t"),n=parseFloat(z[0]),g=z[1],r=parseFloat(z[2]),z=parseFloat(z[3]),void 0===h[g]&&(h[g]=[],ea.push(g)),h[g].push({azimuth:n,elevation:2*Math.PI*r/63,value:z}),void 0===b[0]&&(b[0]=0,l[0]=1E6),b[0]<Math.abs(z)&&(b[0]=Math.abs(z)),l[0]>Math.abs(z)&&(l[0]=Math.abs(z));for(e=
0;e<ea.length;e++){d=ea[e];console.log("max "+b[0]+" min "+l[0]);g=0;r=h[d][0].azimuth;k=0;P[d]=0;n=[];n.push(0);for(z=0;z<h[d].length;z++)q=h[d][z],r!==q.azimuth&&(k<g&&(k=g),P[d]++,n.push(g+n[n.length-1]),g=0),g++,r=q.azimuth;n.push(g+n[n.length-1]);Ja[d]=2*k;console.log("mp"+k+" "+d);v=w=m=0;g=new Float32Array(h[d].length);r=new Float32Array(3*h[d].length);z=new Float32Array(3*h[d].length);q=new Float32Array(3*h[d].length);t=new Uint16Array(k*P[d]*2);for(u=0;u<h[d].length;u++){var E=h[d][u],F=
E.value,p=E.azimuth,E=E.elevation,C=1*F/20,F=(Math.abs(F)/20-Math.abs(l[0])/20)/(Math.abs(b[0])/20-Math.abs(l[0])/20);g[u]=C;F=Va(F);r[3*u]=F.red;r[3*u+1]=F.green;r[3*u+2]=F.blue;C=new A(0,0,1*C);F=new x;F.rotationYMatrix(E);E=new x;E.rotationZMatrix(p);p=F.multiple(E).multipleV(C);p.f[0]>m&&(m=p.f[0]);p.f[1]>w&&(w=p.f[1]);p.f[2]>v&&(v=p.f[2]);z[3*u]=p.f[0];z[3*u+1]=p.f[1];z[3*u+2]=p.f[2]}for(m=0;m<k;m++)for(w=0;w<P[d];w++)t[2*(m+w*k)]=n[w]+m,0<w&&(t[2*(m+w*k)+1]=t[2*(m+(w-1)*k)]);for(n=0;n<k;n++)t[2*
(k-n-1)+1]=t[2*(n+(P[d]-1)*k)];for(n=0;n<h[d].length;n++)m=Ua(z,t,k,P[d],n),q[3*n]=m.f[0],q[3*n+1]=m.f[1],q[3*n+2]=m.f[2];ra[d]=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,ra[d]);a.bufferData(a.ARRAY_BUFFER,g,a.STATIC_DRAW);ta[d]=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,ta[d]);a.bufferData(a.ARRAY_BUFFER,r,a.STATIC_DRAW);sa[d]=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,sa[d]);a.bufferData(a.ARRAY_BUFFER,z,a.STATIC_DRAW);Ia[d]=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,Ia[d]);a.bufferData(a.ARRAY_BUFFER,
q,a.STATIC_DRAW);ua[d]=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,ua[d]);a.bufferData(a.ELEMENT_ARRAY_BUFFER,t,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);Ra[d]=c}la=!0;B=ea[0];console.log("READY OR NOT2")}};f.onerror=function(){console.log("Danger will robinson")};f.readAsText(e)};k.screenshot=function(){Ka=!0};k.takeScreenshot=function(){var a=h.toDataURL(),c=document.createElement("a");c.style.display="none";c.href=a;c.download="screenshot.png";document.body.appendChild(c);c.click();
setTimeout(function(){document.body.removeChild(c);b.URL.revokeObjectURL(a)},100)};k.mouseDown=function(a){Pa=!0;S=a.pageX;T=a.pageY;v===p.Normal?(fa.setMatrixData(C.m),G=r.f[0],N=r.f[1],O=r.f[2]):v===p.HorizontalRotate?fa.setMatrixData(C.m):v===p.HorizontalTranslate?(G=r.f[0],N=r.f[1],O=r.f[2]):v===p.VerticalTranslate?(G=r.f[0],N=r.f[1],O=r.f[2]):v===p.Scale&&(Qa=J)};k.mouseMove=function(a){if(Pa)if(v===p.Normal)if(a.buttons&1){var b=new x;b.rotationYMatrix(-.005*(S-a.pageX));var e=new x;e.rotationXMatrix(.005*
(T-a.pageY));C=fa.multiple(b.multiple(e))}else{if(a.buttons&2||a.buttons&4)r.f[0]=G-.005*(S-a.pageX),a.shiftKey?r.f[1]=N+.005*(T-a.pageY):r.f[2]=O-.005*(T-a.pageY)}else v===p.HorizontalRotate?(b=new x,b.rotationYMatrix(-.005*(S-a.pageX)),C=fa.multiple(b)):v===p.HorizontalTranslate?(r.f[0]=G-.005*(S-a.pageX),r.f[2]=O-.005*(T-a.pageY)):v===p.VerticalTranslate?(r.f[0]=G-.005*(S-a.pageX),r.f[1]=N+.005*(T-a.pageY)):v===p.Scale&&(r.f[0]=G-.005*(S-a.pageX),J=1*Qa+.002*(T-a.pageY))};k.mouseUp=function(a){Pa=
!1;v===p.Normal?(fa.setMatrixData(C.m),O=N=G=0):v===p.HorizontalRotate?fa.setMatrixData(C.m):v===p.HorizontalTranslate?O=N=G=0:v===p.VerticalsTranslate?O=N=G=0:v===p.Scale&&(Qa=1)};k.mouseWheel=function(a){a=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));console.log("delta is "+a);J*=1+.02*a};k.changeColor=function(a,b){document.body.style.backgroundColor=a;var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a),c=c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null;I=[c.r/255,
c.g/255,c.b/255,b/255]};k.startdice=function(){Da=new A(0,-9.81,0);acceleration=new A(0,0,0);za=[];for(var e=0;100>e;e++)za.push(0),za.push(-9.81),za.push(0);h=document.getElementById("glcanvas");var l=document.getElementById("tresholdslider"),q=document.getElementById("colorinput"),d=document.getElementById("alphaslider"),e=document.getElementById("inputfiledialog");h.width=b.innerWidth;h.height=b.innerHeight;ha=document.getElementById("recordButton");xa=document.getElementById("playButton");ya=
document.getElementById("downloadButton");ha.onclick=$a;xa.onclick=ab;ya.onclick=bb;e.addEventListener("change",function(a){k.addRadioDataSet(a.target.files[0])},!0);l.onchange=function(){ma=l.value};d.onchange=q.onchange=function(){console.log("new color "+q.value+" "+d.value);k.changeColor(q.value,d.value)};h.oncontextmenu=function(a){return!1};h.addEventListener&&(h.addEventListener("mousedown",k.mouseDown,!0),h.addEventListener("mouseup",k.mouseUp,!0),h.addEventListener("mousemove",k.mouseMove,
!0),h.addEventListener("mousewheel",k.mouseWheel,!1),h.addEventListener("DOMMouseScroll",k.mouseWheel,!1));h.onkeypress=function(a){"n"===a.key?v=p.Normal:"h"===a.key?v=p.HorizontalTranslate:"v"===a.key?v=p.VerticalTranslate:"r"===a.key?v=p.HorizontalRotate:"s"===a.key?v=p.Scale:"+"===a.key&&(Aa++,Aa>=ea.length&&(Aa=0),B=ea[Aa],console.log("frequency is "+B));console.log("keypressed "+a.key)};h.onkeyup=function(a){console.log("keyup "+a)};h.ondragover=function(a){a.preventDefault();console.log("ondragover")};
h.ondrop=function(a){a.preventDefault();console.log("ondrop");a=a.dataTransfer;if(a.items)for(var b=0;b<a.items.length;b++){if("file"===a.items[b].kind){var c=a.items[b].getAsFile();console.log("... file["+b+"].name = "+c.name);c.name.endsWith("histogram")?(console.log("histogram file"),k.addHistogramSet(c)):c.name.endsWith("txt")&&(console.log("radio data set"),k.addRadioDataSet(c))}}else for(b=0;b<a.files.length;b++)console.log("... file["+b+"].name = "+a.files[b].name)};h.dragend=function(a){a.preventDefault();
var b=a.dataTransfer;if(b.items)for(a=0;a<b.items.length;a++)b.items.remove(a);else a.dataTransfer.clearData()};aspectRatio=h.width/h.height;ja=.5/h.height*h.width*2;da=1;WallLib.setWalls(ja,da,-1.7);h.addEventListener("mousedown",k.mouseDown,!1);h.addEventListener("mouseup",k.mouseUp,!1);h.addEventListener("mousemove",k.mouseMove,!1);document.body.addEventListener("touchstart",function(a){a.target===h&&a.preventDefault()},!1);document.body.addEventListener("touchend",function(a){a.target===h&&a.preventDefault()},
!1);document.body.addEventListener("touchmove",function(a){a.target===h&&a.preventDefault()},!1);h.addEventListener("touchstart",k.touchDown,!1);h.addEventListener("touchend",k.touchUp,!1);h.addEventListener("touchmove",k.touchMove,!1);a=ga(h);Q.translate(r.f[0],r.f[1],r.f[2]);console.log("Started stream capture from canvas element: ",ia);a&&(t=ShaderLib.makeProgram(a,"vertexsphere","fragmentsphere"),t.uPMatrix=a.getUniformLocation(t,"uPMatrix"),t.uMMatrix=a.getUniformLocation(t,"uMMatrix"),t.uVMatrix=
a.getUniformLocation(t,"uVMatrix"),t.uPos=a.getUniformLocation(t,"uPos"),t.uRadius=a.getUniformLocation(t,"uRadius"),t.uColor=a.getUniformLocation(t,"uColor"),t.aVert=a.getAttribLocation(t,"aVert"),t.aNormal=a.getAttribLocation(t,"aNormal"),f=ShaderLib.makeProgram(a,"vertex","fragment"),WallLib.createBuffers(a),f.uPerspectiveMatrix=a.getUniformLocation(f,"projection"),f.uCamera=a.getUniformLocation(f,"camera"),f.uModel=a.getUniformLocation(f,"model"),f.uView=a.getUniformLocation(f,"view"),f.uNormalMat=
a.getUniformLocation(f,"normalMat"),f.uLightPos=a.getUniformLocation(f,"uLightPos"),f.aVertexPosition=a.getAttribLocation(f,"inputPosition"),f.aNormalPosition=a.getAttribLocation(f,"inputNormal"),f.aTextureCoordsPosition=a.getAttribLocation(f,"textureCoords"),f.aTextureCoordsPosition3d=a.getAttribLocation(f,"textureCoords3d"),f.uSampler=a.getUniformLocation(f,"uSampler"),f.uColor=a.getUniformLocation(f,"uColor"),f.uColor2=a.getUniformLocation(f,"uColor2"),f.uColor3=a.getUniformLocation(f,"uColor3"),
f.uDice=a.getUniformLocation(f,"uDice"),f.uTextureOffset=a.getUniformLocation(f,"uTextureOffset"),g=ShaderLib.makeProgram(a,"hvertex","hfragment"),a.useProgram(g),g.uPMatrix=a.getUniformLocation(g,"uPMatrix"),g.uMMatrix=a.getUniformLocation(g,"uMMatrix"),g.uVMatrix=a.getUniformLocation(g,"uVMatrix"),g.uTreshold=a.getUniformLocation(g,"uTreshold"),g.pos=a.getAttribLocation(g,"pos"),g.size=a.getAttribLocation(g,"size"),g.color=a.getAttribLocation(g,"color"),c=ShaderLib.makeProgram(a,"h2vertex","h2fragment"),
a.useProgram(g),c.uPMatrix=a.getUniformLocation(c,"uPMatrix"),c.uMMatrix=a.getUniformLocation(c,"uMMatrix"),c.uVMatrix=a.getUniformLocation(c,"uVMatrix"),c.uNMatrix=a.getUniformLocation(c,"uNMatrix"),c.uTreshold=a.getUniformLocation(c,"uTreshold"),c.uCameraPos=a.getUniformLocation(c,"uCameraPos"),c.uLightPos=a.getUniformLocation(c,"uLightPos"),c.pos=a.getAttribLocation(c,"pos"),c.size=a.getAttribLocation(c,"size"),c.color=a.getAttribLocation(c,"color"),c.normal=a.getAttribLocation(c,"normal"),La=
new cb(a),U(),VrLib&&VrLib.initVR(h,m,H,a,U),m())};return k}"undefined"===typeof PlotterLib&&(b.PlotterLib=m())})(window);
